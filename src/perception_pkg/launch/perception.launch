<launch>
<!-- Perception: point cloud generation using depth_image_proc-->
  <node pkg="nodelet" type="nodelet" name="nodelet_manager" args="manager" />
  <node pkg="nodelet" type="nodelet"
        name="nodelet1"
        args="load depth_image_proc/point_cloud_xyz nodelet_manager">
    <remap from="camera_info" to="/unity_ros/OurCar/Sensors/DepthCamera/camera_info"/>
    <remap from="image_rect" to="/unity_ros/OurCar/Sensors/DepthCamera/image_raw"/>
    <remap from="points" to="points_cloud"/>
    <param name="queue_size" value="10" />
  </node>

<!-- Octomap Server -->
<node pkg="octomap_server" type="octomap_server_node" name="octomap_server">
    
    <remap from="cloud_in" to="transformed_cloud"/>

    <param name="frame_id" value="world" />
    <param name="resolution" value="1.0" />

    <param name="height_map" value="true" />
    <!-- Color for occupied cells (when height_map=false) -->
    <param name="color/r" value="1.0" />
    <param name="color/g" value="0.0" />
    <param name="color/b" value="0.0" />
    <param name="color/a" value="1.0" />

    <!-- Maximum range for point cloud insertion -->
    <param name="sensor_model/max_range" value="40.0" />
    
    <!-- Height filtering for point cloud insertion -->
    <param name="pointcloud_min_z" value="-inf" />
    <param name="pointcloud_max_z" value="100" />

    <!-- Height filtering for occupied cells in the map -->
    <param name="occupancy_min_z" value="-1.0" />
    <param name="occupancy_max_z" value="4.0" />

    <!-- Enable ground plane filtering -->
    <param name="filter_ground" value="false" />
    <!-- <param name="base_frame_id" value="base_footprint" /> -->
    <param name="ground_filter/distance" value="0.04" />
    <param name="ground_filter/angle" value="0.15" />
    <param name="ground_filter/plane_distance" value="0.07" />


    <!-- Sensor model probabilities (hits and misses) -->
    <param name="sensor_model/hit" value="0.7" />
    <param name="sensor_model/miss" value="0.4" />

    <!-- Sensor model probability clamping range -->
    <param name="sensor_model/min" value="0.12" />
    <param name="sensor_model/max" value="0.97" />

    <!-- Whether topics are published latched -->
    <param name="latch" value="false" />
</node>
<node pkg="rviz" type="rviz" name="rviz" args="-d $(find perception_pkg)/cfg/global_map_2.rviz"/> --
  
<!-- <node pkg="rviz" type="rviz" name="rviz" args="-d $(find perception_pkg)/cfg/point_cloud.rviz"/> -->
<node pkg="perception_pkg" type="global_mapping_node" name="global_mapping_node" output="screen"> </node>
<!-- <node pkg="rviz" type="rviz" name="rviz" args="-d $(find perception_pkg)/cfg/global_map.rviz"/> -->

<node pkg="perception_pkg" type="global_mapping_2Dmap_node" name="global_mapping_2Dmap_node" output="screen"> </node>

</launch>
